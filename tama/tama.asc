Version 4
SHEET 1 1588 1200
WIRE -384 -112 -416 -112
WIRE -256 -112 -288 -112
WIRE -144 -112 -160 -112
WIRE -128 -112 -144 -112
WIRE -16 -112 -32 -112
WIRE 0 -112 -16 -112
WIRE 128 -112 96 -112
WIRE -416 -64 -416 -112
WIRE -144 -48 -144 -112
WIRE -128 -48 -144 -48
WIRE -16 -48 -16 -112
WIRE 0 -48 -16 -48
WIRE -416 32 -416 16
WIRE -336 272 -368 272
WIRE -224 272 -240 272
WIRE -208 272 -224 272
WIRE -96 272 -112 272
WIRE -80 272 -96 272
WIRE 32 272 16 272
WIRE 144 272 128 272
WIRE 256 272 240 272
WIRE 368 272 352 272
WIRE 384 272 368 272
WIRE 496 272 480 272
WIRE 608 272 592 272
WIRE 720 272 704 272
WIRE 832 272 816 272
WIRE 944 272 928 272
WIRE 1072 272 1040 272
WIRE -224 320 -224 272
WIRE -96 320 -96 272
WIRE 368 352 368 272
WIRE 656 352 656 320
WIRE 656 352 368 352
WIRE -32 384 -32 320
WIRE 16 384 -32 384
WIRE 304 384 304 320
WIRE 352 384 304 384
WIRE -224 496 -240 496
WIRE -176 496 -224 496
WIRE 16 496 -32 496
WIRE 64 496 16 496
WIRE 192 496 160 496
WIRE 224 496 192 496
WIRE 352 496 320 496
WIRE 384 496 352 496
WIRE -368 528 -400 528
WIRE -224 528 -272 528
WIRE -176 528 -224 528
WIRE 192 544 192 496
WIRE -368 560 -400 560
WIRE -224 560 -272 560
WIRE -176 560 -224 560
WIRE -176 592 -208 592
WIRE -208 656 -208 592
WIRE 192 656 192 544
WIRE 192 656 -208 656
WIRE 496 720 448 720
WIRE -240 752 -256 752
WIRE -176 752 -240 752
WIRE 16 752 -32 752
WIRE 64 752 16 752
WIRE 192 752 160 752
WIRE 224 752 192 752
WIRE 352 752 320 752
WIRE 384 752 352 752
WIRE 448 768 448 720
WIRE -240 784 -256 784
WIRE -176 784 -240 784
WIRE 192 800 192 752
WIRE -176 816 -208 816
WIRE 448 896 448 848
WIRE -208 912 -208 816
WIRE 192 912 192 800
WIRE 192 912 -208 912
FLAG -416 32 0
FLAG 16 384 th1
FLAG 352 384 th1dt1
FLAG 448 896 0
FLAG 496 720 th2deg
FLAG -224 528 tha
FLAG -224 560 fn
FLAG -224 496 tq
FLAG 16 496 th1dt2
FLAG -240 752 tha
FLAG -240 784 fn
FLAG 16 752 th2dt2
FLAG 352 496 th1
FLAG 352 752 th2
FLAG 192 544 th1dt1
FLAG 192 800 th2dt1
FLAG -400 528 th1
FLAG -400 560 th2
FLAG 128 -112 cpuout
FLAG -368 272 cpuout
FLAG 1072 272 tq
FLAG 0 -48 integout
FLAG -224 320 avg100out
FLAG -96 320 lpfout
FLAG -128 -48 avg25out
SYMBOL voltage -416 -80 R0
SYMATTR InstName V1
SYMATTR Value PULSE(0 {mtrrad} 0 1p 1p {mtime})
SYMBOL avg25 -208 -112 R0
WINDOW -1 0 0 Left 0
WINDOW 38 -16 20 Left 0
SYMATTR InstName U2
SYMBOL kpp 80 272 R0
SYMATTR InstName U4
SYMBOL def 304 272 R0
SYMATTR InstName X1
SYMBOL integ 432 272 R0
SYMATTR InstName U1
SYMBOL kvi 544 272 R0
SYMATTR InstName U5
SYMBOL add 656 272 R0
SYMATTR InstName U6
SYMBOL kvp 768 272 R0
SYMATTR InstName U7
SYMBOL v_lim 192 272 R0
SYMATTR InstName U8
SYMBOL t_lim 992 272 R0
SYMATTR InstName U9
SYMBOL t_gen 880 272 R0
SYMATTR InstName U10
SYMBOL integ 112 496 R0
SYMATTR InstName U14
SYMBOL integ 272 496 R0
SYMATTR InstName U15
SYMBOL integ 272 752 R0
SYMATTR InstName U17
SYMBOL integ 112 752 R0
SYMATTR InstName U16
SYMBOL def -32 272 R0
SYMATTR InstName X2
SYMBOL bv 448 752 R0
SYMATTR InstName B5
SYMATTR Value V=V(th2) / pi * 180 / gretio
SYMBOL mysym/f_gen -320 544 R0
SYMATTR InstName U12
SYMBOL mysym/th1dt2 -128 512 R0
SYMATTR InstName U11
SYMBOL mysym/th2dt2 -128 768 R0
SYMATTR InstName U13
SYMBOL mysym/shape -336 -112 R0
WINDOW 38 -6 -1 Left 0
SYMATTR InstName U23
SYMBOL mysym/integ -80 -112 R0
SYMATTR InstName U21
SYMBOL mysym/DS 48 -112 R0
SYMATTR InstName U3
SYMBOL mysym/avg100 -288 272 R0
SYMATTR InstName U20
SYMBOL mysym/lpf -160 272 R0
SYMATTR InstName U19
TEXT 272 -160 Left 3 !.tran 10\n.ic V(th1)=0 V(th1dt1)=0 V(th2)=0 V(th2dt1)=0   \n.param kpp=10 kvp=30 kvi=10\n.param v_lim=2000/60*2*pi v_min=-v_lim v_max=v_lim\n.param t_min=- t_lim t_max=t_lim  t_lim=8.76\n.param JM=0.00188 JL=0.0196 DM=0.0001 DL=0.01\n.param kgb=1000 dbdeg=0.1 dbrad=dbdeg*pi/180\n.param azposdeg=180 azposrad=azposdeg*pi/180\n.param gretio=81*110/23 mtrposrad=azposrad*gretio\n.param mtrrpm=2000 mtrrad=mtrrpm/60*2*pi\n.param mtime=mtrposrad/mtrrad
