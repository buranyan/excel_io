Version 4
SHEET 1 1588 1200
WIRE -384 176 -416 176
WIRE -256 176 -288 176
WIRE -128 176 -160 176
WIRE 16 176 -32 176
WIRE 64 176 16 176
WIRE 192 176 160 176
WIRE 320 176 288 176
WIRE 448 176 416 176
WIRE 576 176 544 176
WIRE 608 176 576 176
WIRE 736 176 704 176
WIRE 864 176 832 176
WIRE 992 176 960 176
WIRE 1120 176 1088 176
WIRE 1248 176 1216 176
WIRE 1376 176 1344 176
WIRE -416 256 -416 176
WIRE 576 256 576 176
WIRE 912 256 912 224
WIRE 912 256 576 256
WIRE 112 304 112 224
WIRE 160 304 112 304
WIRE 496 304 496 224
WIRE 544 304 496 304
WIRE -416 400 -416 336
WIRE -368 496 -416 496
WIRE -48 496 -96 496
WIRE 816 528 784 528
WIRE 944 528 912 528
WIRE 976 528 944 528
WIRE 1104 528 1072 528
WIRE -416 544 -416 496
WIRE -96 544 -96 496
WIRE 944 592 944 528
WIRE 1104 592 944 592
WIRE -416 672 -416 624
WIRE -96 672 -96 624
WIRE 816 672 784 672
WIRE 944 672 912 672
WIRE 976 672 944 672
WIRE 1104 672 1072 672
WIRE -368 736 -416 736
WIRE 944 736 944 672
WIRE 1104 736 944 736
WIRE -416 784 -416 736
WIRE -416 912 -416 864
WIRE -368 976 -416 976
WIRE -416 1024 -416 976
WIRE -416 1152 -416 1104
FLAG -416 400 0
FLAG 1104 592 th1dt1
FLAG 1104 736 th2dt1
FLAG 1104 528 th1
FLAG 1376 176 tq
FLAG 160 304 th1
FLAG 544 304 th1dt1
FLAG 16 176 poscmd
FLAG 1104 672 th2
FLAG -416 672 0
FLAG -368 496 tha
FLAG -96 672 0
FLAG -48 496 fn
FLAG -368 736 th1dt2
FLAG -416 912 0
FLAG -368 976 th2dt2
FLAG -416 1152 0
FLAG 784 528 th1dt2
FLAG 784 672 th2dt2
SYMBOL voltage -416 240 R0
SYMATTR InstName V1
SYMATTR Value PULSE(0 {mtrrad} 0 1p 1p {mtime})
SYMBOL avg25 -336 176 R0
WINDOW -1 0 0 Left 0
WINDOW 38 -16 20 Left 0
SYMATTR InstName U2
SYMBOL mysym/kpp 240 176 R0
SYMATTR InstName U4
SYMBOL mysym/def 496 176 R0
SYMATTR InstName X1
SYMBOL mysym/integ 656 176 R0
SYMATTR InstName U1
SYMBOL mysym/kvi 784 176 R0
SYMATTR InstName U5
SYMBOL mysym/add 912 176 R0
SYMATTR InstName U6
SYMBOL mysym/kvp 1040 176 R0
SYMATTR InstName U7
SYMBOL mysym/v_lim 368 176 R0
SYMATTR InstName U8
SYMBOL mysym/t_lim 1296 176 R0
SYMATTR InstName U9
SYMBOL mysym/t_gen 1168 176 R0
SYMATTR InstName U10
SYMBOL mysym/integ 864 528 R0
SYMATTR InstName U14
SYMBOL mysym/integ 1024 528 R0
SYMATTR InstName U15
SYMBOL mysym/integ 1024 672 R0
SYMATTR InstName U17
SYMBOL mysym/integ 864 672 R0
SYMATTR InstName U16
SYMBOL mysym/def 112 176 R0
SYMATTR InstName X2
SYMBOL mysym/integ -80 176 R0
SYMATTR InstName U22
SYMBOL bv -416 528 R0
SYMATTR InstName B1
SYMATTR Value V=abs(V(th2)-V(th1))
SYMBOL bv -96 528 R0
SYMATTR InstName B2
SYMATTR Value V=-sgn(V(th2)-V(th1)) * {kgb} * (V(tha) - {dbrad})
SYMBOL bv -416 768 R0
SYMATTR InstName B3
SYMATTR Value V=if(V(tha) < {dbrad}, (V(tq) - {DM} * V(th1dt1))/ {JM}, (V(tq) - {DM} * V(th1dt1) - V(fn)) / {JM})
SYMBOL bv -416 1008 R0
SYMATTR InstName B4
SYMATTR Value V=if(V(tha) < {dbrad}, ( - {DL} * V(th2dt1))/ {JL}, (V(fn) - {DL} * V(th2dt1)) / {JL})
SYMBOL mysym/avg100 -208 176 R0
SYMATTR InstName U3
TEXT -432 -192 Left 2 !.tran 12.5\n.ic th1=0 th1dt1=0 th2=0 th2dt1=0\n.param kpp=10 kvp=30 kvi=10\n.param v_lim=2000/60*2*pi v_min=-v_lim v_max=v_lim\n.param t_min=- t_lim t_max=t_lim  t_lim=8.76\n.param JM=0.00188 JL=0.0196 DM=0.0001 DL=0.0001\n.param kgb=10 dbdeg=0.1 dbrad=dbdeg*pi/180\n.param azposdeg=180 azposrad=azposdeg*pi/180\n.param gretio=81*110/23 mtrposrad=azposrad*gretio\n.param mtrrpm=2000 mtrrad=mtrrpm/60*2*pi\n.param mtime=mtrposrad/mtrrad
